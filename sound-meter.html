<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
  <title>p5js Template</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.13/p5.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.17/addons/p5.sound.js"></script>
  <script>
    var numBars;

    function setup() {
      createCanvas(windowWidth, windowHeight);
      numBars = 5;

      mic = new p5.AudioIn()
      mic.start();

      frameRate(20);
    }

    function draw() {
      background(0);

      micLevel = mic.getLevel();
      micLevel = map(micLevel, 0, 0.23, 0, height);
      console.log(micLevel);

      for (var i = 0; i < numBars; i++) {
        // var barY = random(height);

        var barY = micLevel;
        barY = constrain(barY, 0, height);

        var g = map(barY, 0, height / 3, 0, 255);
        var r = map(barY, height / 3, height * 2 / 3, 0, 255);

        if (g > 510) {
          var g = map(g, 510, 765, 255, 0);
        }
        fill(r, g, 0);
        // console.log(g);
        // rect(100*i+10,height-barY,80,height);
        rect(width / 5 * i + 10, height - barY + random(-height / 10, height / 10), width * .16, height * 1.1);
      }
    }

    function mousePressed() {
      var fs = fullScreen();
      fullScreen(!fs);
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }
  </script>
  <style type="text/css">
    body {
      overflow: hidden;
    }
  </style>
</head>

<body>

</body>

</html>
